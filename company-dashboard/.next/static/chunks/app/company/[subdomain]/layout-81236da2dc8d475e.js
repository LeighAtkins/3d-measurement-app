(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[342],{627:(e,t,s)=>{"use strict";var r=s(7192);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},2415:(e,t,s)=>{Promise.resolve().then(s.bind(s,8064))},7268:(e,t,s)=>{"use strict";s.d(t,{R2:()=>o,gH:()=>c});var r=s(8660);class n{setToken(e){this.token=e,e?localStorage.setItem("auth_token",e):localStorage.removeItem("auth_token")}getToken(){if(this.token)return this.token;{let e=localStorage.getItem("auth_token");if(e&&this.isTokenValid(e))return this.token=e,e}return null}isTokenValid(e){try{let t=JSON.parse(atob(e.split(".")[1]));return 1e3*t.exp>Date.now()}catch(e){return!1}}handleUnauthorized(){this.setToken(null),window.location.href="/login"}transformError(e){var t,s;let r={error:"Unknown error",status:(null==(t=e.response)?void 0:t.status)||500};return(null==(s=e.response)?void 0:s.data)?(r.error=e.response.data.error||e.response.data.message||e.message,r.message=e.response.data.message,r.details=e.response.data.details):e.message&&(r.error=e.message),r}async get(e,t){return(await this.client.get(e,t)).data}async post(e,t,s){return(await this.client.post(e,t,s)).data}async put(e,t,s){return(await this.client.put(e,t,s)).data}async delete(e,t){return(await this.client.delete(e,t)).data}constructor(e="http://localhost:8000"){this.token=null,this.client=r.A.create({baseURL:e,timeout:3e4,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>(this.token&&(e.headers.Authorization="Bearer ".concat(this.token)),e)),this.client.interceptors.response.use(e=>e,e=>{var t;throw(null==(t=e.response)?void 0:t.status)===401&&this.handleUnauthorized(),this.transformError(e)})}}let a=new n;class i{async signin(e){return this.client.post("/api/auth/signin",{email:e})}async verify(e,t){let s="/api/auth/verify?token=".concat(encodeURIComponent(e),"&email=").concat(encodeURIComponent(t)),r=await this.client.get(s);return r.token&&this.client.setToken(r.token),r}logout(){this.client.setToken(null),window.location.href="/login"}getCurrentUser(){let e=this.client.getToken();if(!e)return null;try{let t=JSON.parse(atob(e.split(".")[1]));return{id:t.userId,email:t.email,role:t.role,companyId:t.companyId}}catch(e){return null}}isAuthenticated(){return null!==this.client.getToken()}constructor(e=a){this.client=e}}let o=new i;class l{async list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=new URLSearchParams;t.page&&s.append("page",t.page.toString()),t.limit&&s.append("limit",t.limit.toString()),t.status&&s.append("status",t.status);let r=s.toString(),n="/api/company/".concat(e,"/orders").concat(r?"?".concat(r):"");return this.client.get(n)}async get(e,t){return this.client.get("/api/company/".concat(e,"/orders/").concat(t))}async listClientOrders(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;e.page&&t.append("page",e.page.toString()),e.limit&&t.append("limit",e.limit.toString()),e.status&&t.append("status",e.status);let s=t.toString();return this.client.get("/api/orders".concat(s?"?".concat(s):""))}async getClientOrder(e){return this.client.get("/api/orders/".concat(e))}constructor(e=a){this.client=e}}let c=new l;class u{async create(e,t,s){return this.client.post("/api/company/".concat(e,"/orders/").concat(t,"/measurements"),s)}async update(e,t,s,r){return this.client.put("/api/company/".concat(e,"/orders/").concat(t,"/measurements/").concat(s),r)}async updateValue(e,t,s){return this.client.put("/api/orders/".concat(e,"/measurements/").concat(t),s)}constructor(e=a){this.client=e}}new u},7535:(e,t,s)=>{"use strict";s.d(t,{OJ:()=>p,$n:()=>i,Zp:()=>o,Wu:()=>u,aR:()=>l,ZB:()=>c,kt:()=>d,As:()=>g});var r=s(3365),n=s(1521),a=s(4584);let i=e=>{let{variant:t="primary",size:s="md",loading:n=!1,disabled:i,className:o,children:l,...c}=e;return(0,r.jsxs)("button",{className:(0,a.$)("inline-flex items-center justify-center font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"text-gray-700 hover:bg-gray-100 focus:ring-gray-500"}[t],{sm:"px-3 py-2 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[s],o),disabled:i||n,...c,children:[n&&(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),l]})},o=e=>{let{children:t,className:s,padding:n="md"}=e;return(0,r.jsx)("div",{className:(0,a.$)("bg-white rounded-lg border border-gray-200 shadow-sm",{sm:"p-3",md:"p-6",lg:"p-8"}[n],s),children:t})},l=e=>{let{children:t,className:s}=e;return(0,r.jsx)("div",{className:(0,a.$)("mb-4",s),children:t})},c=e=>{let{children:t,className:s}=e;return(0,r.jsx)("h3",{className:(0,a.$)("text-lg font-semibold text-gray-900",s),children:t})},u=e=>{let{children:t,className:s}=e;return(0,r.jsx)("div",{className:(0,a.$)(s),children:t})},d=e=>{let{size:t="md",className:s}=e;return(0,r.jsx)("div",{className:(0,a.$)("animate-spin rounded-full border-b-2 border-blue-600",{sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[t],s)})};var m=s(7268);let h=(0,n.createContext)(void 0),p=e=>{let{children:t}=e,[s,a]=(0,n.useState)(null),[i,o]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{let e=m.R2.getCurrentUser();e&&a(e),o(!1)},[]),(0,r.jsx)(h.Provider,{value:{user:s,loading:i,login:(e,t)=>{a(t)},logout:()=>{m.R2.logout(),a(null)},isAuthenticated:!!s},children:t})},g=()=>{let e=(0,n.useContext)(h);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8064:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var r=s(3365),n=s(1521),a=s(627),i=s(7535);function o(e){var t;let{children:s,params:o}=e,{user:l,loading:c}=(0,i.As)(),u=(0,a.useRouter)(),[d,m]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{if(!c){if(!l)return void u.push("/login");if("COMPANY_ADMIN"===l.role||"COMPANY_USER"===l.role){var e;if((null==(e=l.company)?void 0:e.subdomain)!==o.subdomain)return void u.push("/login?error=unauthorized")}else if("ADMIN"!==l.role)return void u.push("/login?error=unauthorized");m(!1)}},[l,c,o.subdomain,u]),c||d)?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{children:"Loading dashboard..."})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:(null==l||null==(t=l.company)?void 0:t.name)||"Company Dashboard"}),(0,r.jsxs)("span",{className:"ml-2 text-sm text-gray-500",children:["/",o.subdomain]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("span",{className:"text-sm text-gray-700",children:(null==l?void 0:l.name)||(null==l?void 0:l.email)}),(0,r.jsx)("button",{onClick:()=>{u.push("/login")},className:"text-sm text-gray-500 hover:text-gray-700",children:"Sign out"})]})]})})}),(0,r.jsx)("nav",{className:"bg-white shadow-sm",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex space-x-8",children:[(0,r.jsx)("a",{href:"/company/".concat(o.subdomain,"/orders"),className:"border-b-2 border-blue-500 py-4 px-1 text-sm font-medium text-blue-600",children:"Orders"}),(0,r.jsx)("a",{href:"/company/".concat(o.subdomain,"/settings"),className:"border-b-2 border-transparent py-4 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300",children:"Settings"})]})})}),(0,r.jsx)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:s})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[851,347,870,358],()=>t(2415)),_N_E=e.O()}]);