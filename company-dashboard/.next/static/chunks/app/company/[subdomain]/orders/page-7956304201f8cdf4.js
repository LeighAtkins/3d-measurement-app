(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[239],{627:(e,t,s)=>{"use strict";var r=s(7192);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},636:(e,t,s)=>{Promise.resolve().then(s.bind(s,3949))},3949:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var r=s(3365),a=s(1521),n=s(627),i=s(7535),l=s(7268);function o(){let e=(0,n.useParams)().subdomain,[t,s]=(0,a.useState)([]),[o,c]=(0,a.useState)(!0),[d,u]=(0,a.useState)(""),[h,m]=(0,a.useState)(1),[g,p]=(0,a.useState)(1);(0,a.useEffect)(()=>{x()},[e,h]);let x=async()=>{try{u("");let t=await l.gH.list(e,{page:h,limit:10});s(t.orders),p(t.pagination.pages)}catch(e){u(e.error||"Failed to load orders")}finally{c(!1)}},y=e=>(0,r.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat({SUBMITTED:"bg-blue-100 text-blue-800",PROCESSING:"bg-yellow-100 text-yellow-800",MODELING_FAILED:"bg-red-100 text-red-800",READY_FOR_MEASUREMENT:"bg-purple-100 text-purple-800",MEASUREMENTS_DRAWN:"bg-indigo-100 text-indigo-800",CLIENT_INPUT_NEEDED:"bg-orange-100 text-orange-800",COMPLETED:"bg-green-100 text-green-800",CANCELLED:"bg-gray-100 text-gray-800"}[e]||"bg-gray-100 text-gray-800"),children:e.replace(/_/g," ")}),f=e=>(0,r.jsx)("span",{className:"text-sm font-medium ".concat({LOW:"text-gray-600",NORMAL:"text-blue-600",HIGH:"text-orange-600",URGENT:"text-red-600"}[e]||"text-gray-600"),children:e});return o?(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsx)(i.kt,{size:"lg"})}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Orders"}),(0,r.jsx)(i.$n,{onClick:()=>window.location.reload(),children:"Refresh"})]}),d&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,r.jsx)("p",{className:"text-red-800",children:d})}),0===t.length?(0,r.jsx)(i.Zp,{children:(0,r.jsx)(i.Wu,{children:(0,r.jsx)("div",{className:"text-center py-12",children:(0,r.jsx)("p",{className:"text-gray-500",children:"No orders found"})})})}):(0,r.jsx)("div",{className:"grid gap-6",children:t.map(t=>{var s,a;return(0,r.jsx)(i.Zp,{className:"hover:shadow-md transition-shadow",children:(0,r.jsx)(i.Wu,{children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:t.orderNumber}),y(t.status),f(t.priority)]}),(0,r.jsxs)("p",{className:"text-gray-600",children:["Client: ",(null==(s=t.client)?void 0:s.name)||(null==(a=t.client)?void 0:a.email)]}),t.notes&&(0,r.jsx)("p",{className:"text-sm text-gray-500",children:t.notes}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[(0,r.jsxs)("span",{children:["Created: ",new Date(t.createdAt).toLocaleDateString()]}),t.dueDate&&(0,r.jsxs)("span",{children:["Due: ",new Date(t.dueDate).toLocaleDateString()]}),t.measurements&&(0,r.jsxs)("span",{children:[t.measurements.length," measurements"]})]})]}),(0,r.jsx)("div",{className:"flex space-x-2",children:(0,r.jsx)(i.$n,{variant:"secondary",size:"sm",onClick:()=>{window.location.href="/company/".concat(e,"/orders/").concat(t.id)},children:"View Details"})})]})})},t.id)})}),g>1&&(0,r.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,r.jsx)(i.$n,{variant:"secondary",disabled:1===h,onClick:()=>m(h-1),children:"Previous"}),(0,r.jsxs)("span",{className:"flex items-center px-4 text-sm text-gray-700",children:["Page ",h," of ",g]}),(0,r.jsx)(i.$n,{variant:"secondary",disabled:h===g,onClick:()=>m(h+1),children:"Next"})]})]})}},7268:(e,t,s)=>{"use strict";s.d(t,{R2:()=>l,gH:()=>c});var r=s(8660);class a{setToken(e){this.token=e,e?localStorage.setItem("auth_token",e):localStorage.removeItem("auth_token")}getToken(){if(this.token)return this.token;{let e=localStorage.getItem("auth_token");if(e&&this.isTokenValid(e))return this.token=e,e}return null}isTokenValid(e){try{let t=JSON.parse(atob(e.split(".")[1]));return 1e3*t.exp>Date.now()}catch(e){return!1}}handleUnauthorized(){this.setToken(null),window.location.href="/login"}transformError(e){var t,s;let r={error:"Unknown error",status:(null==(t=e.response)?void 0:t.status)||500};return(null==(s=e.response)?void 0:s.data)?(r.error=e.response.data.error||e.response.data.message||e.message,r.message=e.response.data.message,r.details=e.response.data.details):e.message&&(r.error=e.message),r}async get(e,t){return(await this.client.get(e,t)).data}async post(e,t,s){return(await this.client.post(e,t,s)).data}async put(e,t,s){return(await this.client.put(e,t,s)).data}async delete(e,t){return(await this.client.delete(e,t)).data}constructor(e="http://localhost:8000"){this.token=null,this.client=r.A.create({baseURL:e,timeout:3e4,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>(this.token&&(e.headers.Authorization="Bearer ".concat(this.token)),e)),this.client.interceptors.response.use(e=>e,e=>{var t;throw(null==(t=e.response)?void 0:t.status)===401&&this.handleUnauthorized(),this.transformError(e)})}}let n=new a;class i{async signin(e){return this.client.post("/api/auth/signin",{email:e})}async verify(e,t){let s="/api/auth/verify?token=".concat(encodeURIComponent(e),"&email=").concat(encodeURIComponent(t)),r=await this.client.get(s);return r.token&&this.client.setToken(r.token),r}logout(){this.client.setToken(null),window.location.href="/login"}getCurrentUser(){let e=this.client.getToken();if(!e)return null;try{let t=JSON.parse(atob(e.split(".")[1]));return{id:t.userId,email:t.email,role:t.role,companyId:t.companyId}}catch(e){return null}}isAuthenticated(){return null!==this.client.getToken()}constructor(e=n){this.client=e}}let l=new i;class o{async list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=new URLSearchParams;t.page&&s.append("page",t.page.toString()),t.limit&&s.append("limit",t.limit.toString()),t.status&&s.append("status",t.status);let r=s.toString(),a="/api/company/".concat(e,"/orders").concat(r?"?".concat(r):"");return this.client.get(a)}async get(e,t){return this.client.get("/api/company/".concat(e,"/orders/").concat(t))}async listClientOrders(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;e.page&&t.append("page",e.page.toString()),e.limit&&t.append("limit",e.limit.toString()),e.status&&t.append("status",e.status);let s=t.toString();return this.client.get("/api/orders".concat(s?"?".concat(s):""))}async getClientOrder(e){return this.client.get("/api/orders/".concat(e))}constructor(e=n){this.client=e}}let c=new o;class d{async create(e,t,s){return this.client.post("/api/company/".concat(e,"/orders/").concat(t,"/measurements"),s)}async update(e,t,s,r){return this.client.put("/api/company/".concat(e,"/orders/").concat(t,"/measurements/").concat(s),r)}async updateValue(e,t,s){return this.client.put("/api/orders/".concat(e,"/measurements/").concat(t),s)}constructor(e=n){this.client=e}}new d},7535:(e,t,s)=>{"use strict";s.d(t,{OJ:()=>g,$n:()=>i,Zp:()=>l,Wu:()=>d,aR:()=>o,ZB:()=>c,kt:()=>u,As:()=>p});var r=s(3365),a=s(1521),n=s(4584);let i=e=>{let{variant:t="primary",size:s="md",loading:a=!1,disabled:i,className:l,children:o,...c}=e;return(0,r.jsxs)("button",{className:(0,n.$)("inline-flex items-center justify-center font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"text-gray-700 hover:bg-gray-100 focus:ring-gray-500"}[t],{sm:"px-3 py-2 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[s],l),disabled:i||a,...c,children:[a&&(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),o]})},l=e=>{let{children:t,className:s,padding:a="md"}=e;return(0,r.jsx)("div",{className:(0,n.$)("bg-white rounded-lg border border-gray-200 shadow-sm",{sm:"p-3",md:"p-6",lg:"p-8"}[a],s),children:t})},o=e=>{let{children:t,className:s}=e;return(0,r.jsx)("div",{className:(0,n.$)("mb-4",s),children:t})},c=e=>{let{children:t,className:s}=e;return(0,r.jsx)("h3",{className:(0,n.$)("text-lg font-semibold text-gray-900",s),children:t})},d=e=>{let{children:t,className:s}=e;return(0,r.jsx)("div",{className:(0,n.$)(s),children:t})},u=e=>{let{size:t="md",className:s}=e;return(0,r.jsx)("div",{className:(0,n.$)("animate-spin rounded-full border-b-2 border-blue-600",{sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[t],s)})};var h=s(7268);let m=(0,a.createContext)(void 0),g=e=>{let{children:t}=e,[s,n]=(0,a.useState)(null),[i,l]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{let e=h.R2.getCurrentUser();e&&n(e),l(!1)},[]),(0,r.jsx)(m.Provider,{value:{user:s,loading:i,login:(e,t)=>{n(t)},logout:()=>{h.R2.logout(),n(null)},isAuthenticated:!!s},children:t})},p=()=>{let e=(0,a.useContext)(m);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[851,347,870,358],()=>t(636)),_N_E=e.O()}]);