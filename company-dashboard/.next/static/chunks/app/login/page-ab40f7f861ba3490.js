(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{627:(e,t,r)=>{"use strict";var s=r(7192);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},1618:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var s=r(3365),n=r(1521),a=r(627),i=r(7535),l=r(7268);function o(){let[e,t]=(0,n.useState)(""),[r,o]=(0,n.useState)(!1),[c,u]=(0,n.useState)(""),[d,m]=(0,n.useState)(""),h=(0,a.useRouter)(),g=(0,a.useSearchParams)(),p=g.get("token"),y=g.get("email"),x=async(e,t)=>{o(!0);try{await l.R2.verify(e,t),h.push("/company")}catch(e){m(e.error||"Verification failed")}finally{o(!1)}};(0,n.useEffect)(()=>{p&&y&&x(p,y)},[p,y]);let f=async t=>{t.preventDefault(),o(!0),m(""),u("");try{let t=await l.R2.signin(e);u("Magic link sent to ".concat(e,". Check your email and click the link to sign in.")),t.verifyUrl&&u("Development mode: Magic link sent. You can also click here to verify: ".concat(t.verifyUrl))}catch(e){m(e.error||"Failed to send magic link")}finally{o(!1)}};return r&&p?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,s.jsx)(i.Zp,{className:"w-full max-w-md",children:(0,s.jsxs)(i.Wu,{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{children:"Verifying your login..."})]})})}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,s.jsxs)(i.Zp,{className:"w-full max-w-md",children:[(0,s.jsxs)(i.aR,{children:[(0,s.jsx)(i.ZB,{className:"text-center text-2xl font-bold text-gray-900",children:"Company Dashboard"}),(0,s.jsx)("p",{className:"text-center text-gray-600",children:"Sign in to manage your 3D measurement orders"})]}),(0,s.jsxs)(i.Wu,{children:[c&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-md",children:(0,s.jsx)("p",{className:"text-green-800 text-sm",children:c})}),d&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:(0,s.jsx)("p",{className:"text-red-800 text-sm",children:d})}),(0,s.jsxs)("form",{onSubmit:f,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),(0,s.jsx)("input",{id:"email",type:"email",value:e,onChange:e=>t(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your email",disabled:r})]}),(0,s.jsx)(i.$n,{type:"submit",className:"w-full",loading:r,disabled:!e.trim(),children:"Send Magic Link"})]}),(0,s.jsx)("div",{className:"mt-6 text-center",children:(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"For company admins and users only"})})]})]})})}},2671:(e,t,r)=>{Promise.resolve().then(r.bind(r,1618))},7268:(e,t,r)=>{"use strict";r.d(t,{R2:()=>l,gH:()=>c});var s=r(8660);class n{setToken(e){this.token=e,e?localStorage.setItem("auth_token",e):localStorage.removeItem("auth_token")}getToken(){if(this.token)return this.token;{let e=localStorage.getItem("auth_token");if(e&&this.isTokenValid(e))return this.token=e,e}return null}isTokenValid(e){try{let t=JSON.parse(atob(e.split(".")[1]));return 1e3*t.exp>Date.now()}catch(e){return!1}}handleUnauthorized(){this.setToken(null),window.location.href="/login"}transformError(e){var t,r;let s={error:"Unknown error",status:(null==(t=e.response)?void 0:t.status)||500};return(null==(r=e.response)?void 0:r.data)?(s.error=e.response.data.error||e.response.data.message||e.message,s.message=e.response.data.message,s.details=e.response.data.details):e.message&&(s.error=e.message),s}async get(e,t){return(await this.client.get(e,t)).data}async post(e,t,r){return(await this.client.post(e,t,r)).data}async put(e,t,r){return(await this.client.put(e,t,r)).data}async delete(e,t){return(await this.client.delete(e,t)).data}constructor(e="http://localhost:8000"){this.token=null,this.client=s.A.create({baseURL:e,timeout:3e4,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>(this.token&&(e.headers.Authorization="Bearer ".concat(this.token)),e)),this.client.interceptors.response.use(e=>e,e=>{var t;throw(null==(t=e.response)?void 0:t.status)===401&&this.handleUnauthorized(),this.transformError(e)})}}let a=new n;class i{async signin(e){return this.client.post("/api/auth/signin",{email:e})}async verify(e,t){let r="/api/auth/verify?token=".concat(encodeURIComponent(e),"&email=").concat(encodeURIComponent(t)),s=await this.client.get(r);return s.token&&this.client.setToken(s.token),s}logout(){this.client.setToken(null),window.location.href="/login"}getCurrentUser(){let e=this.client.getToken();if(!e)return null;try{let t=JSON.parse(atob(e.split(".")[1]));return{id:t.userId,email:t.email,role:t.role,companyId:t.companyId}}catch(e){return null}}isAuthenticated(){return null!==this.client.getToken()}constructor(e=a){this.client=e}}let l=new i;class o{async list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new URLSearchParams;t.page&&r.append("page",t.page.toString()),t.limit&&r.append("limit",t.limit.toString()),t.status&&r.append("status",t.status);let s=r.toString(),n="/api/company/".concat(e,"/orders").concat(s?"?".concat(s):"");return this.client.get(n)}async get(e,t){return this.client.get("/api/company/".concat(e,"/orders/").concat(t))}async listClientOrders(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;e.page&&t.append("page",e.page.toString()),e.limit&&t.append("limit",e.limit.toString()),e.status&&t.append("status",e.status);let r=t.toString();return this.client.get("/api/orders".concat(r?"?".concat(r):""))}async getClientOrder(e){return this.client.get("/api/orders/".concat(e))}constructor(e=a){this.client=e}}let c=new o;class u{async create(e,t,r){return this.client.post("/api/company/".concat(e,"/orders/").concat(t,"/measurements"),r)}async update(e,t,r,s){return this.client.put("/api/company/".concat(e,"/orders/").concat(t,"/measurements/").concat(r),s)}async updateValue(e,t,r){return this.client.put("/api/orders/".concat(e,"/measurements/").concat(t),r)}constructor(e=a){this.client=e}}new u},7535:(e,t,r)=>{"use strict";r.d(t,{OJ:()=>g,$n:()=>i,Zp:()=>l,Wu:()=>u,aR:()=>o,ZB:()=>c,kt:()=>d,As:()=>p});var s=r(3365),n=r(1521),a=r(4584);let i=e=>{let{variant:t="primary",size:r="md",loading:n=!1,disabled:i,className:l,children:o,...c}=e;return(0,s.jsxs)("button",{className:(0,a.$)("inline-flex items-center justify-center font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"text-gray-700 hover:bg-gray-100 focus:ring-gray-500"}[t],{sm:"px-3 py-2 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[r],l),disabled:i||n,...c,children:[n&&(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),o]})},l=e=>{let{children:t,className:r,padding:n="md"}=e;return(0,s.jsx)("div",{className:(0,a.$)("bg-white rounded-lg border border-gray-200 shadow-sm",{sm:"p-3",md:"p-6",lg:"p-8"}[n],r),children:t})},o=e=>{let{children:t,className:r}=e;return(0,s.jsx)("div",{className:(0,a.$)("mb-4",r),children:t})},c=e=>{let{children:t,className:r}=e;return(0,s.jsx)("h3",{className:(0,a.$)("text-lg font-semibold text-gray-900",r),children:t})},u=e=>{let{children:t,className:r}=e;return(0,s.jsx)("div",{className:(0,a.$)(r),children:t})},d=e=>{let{size:t="md",className:r}=e;return(0,s.jsx)("div",{className:(0,a.$)("animate-spin rounded-full border-b-2 border-blue-600",{sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[t],r)})};var m=r(7268);let h=(0,n.createContext)(void 0),g=e=>{let{children:t}=e,[r,a]=(0,n.useState)(null),[i,l]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{let e=m.R2.getCurrentUser();e&&a(e),l(!1)},[]),(0,s.jsx)(h.Provider,{value:{user:r,loading:i,login:(e,t)=>{a(t)},logout:()=>{m.R2.logout(),a(null)},isAuthenticated:!!r},children:t})},p=()=>{let e=(0,n.useContext)(h);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[851,347,870,358],()=>t(2671)),_N_E=e.O()}]);